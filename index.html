<!--
 * @Author: LetMeFly
 * @Date: 2022-06-20 22:21:32
 * @LastEditors: LetMeFly
 * @LastEditTime: 2022-06-22 16:03:31
-->
<!DOCTYPE html>
<html>

<head>
    <title>语法分析</title>
    <meta charset="utf-8">
    <!-- <script src="https://letmefly.xyz/Links/Common.js"></script> -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/LSA.js"></script>
</head>

<body>

    <div class="container">
        <div class="jumbotron">
            <h1>语法分析</h1>
            <div class="row">
                <div class="col-sm-2"><h3>LL(1)</h3></div>
                <div class="col-sm-2"><h3>LR(0)</h3></div>
                <div class="col-sm-2"><h3>SLR(1)</h3></div>
                <div class="col-sm-2"><h3>LR(1)</h3></div>
                <div class="col-sm-2"><h3>SALR(1)</h3></div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <h3>请选择要分析的文法</h3>
                <form id="GrammarChoiceForm">
                    <label><input name="GrammarChoice" type="radio" value="LL1"> LL(1)</label> <br>
                    <label><input name="GrammarChoice" type="radio" value="LR0"> LR(0)</label> <br>
                    <label><input name="GrammarChoice" type="radio" value="SLR1"> SLR(1)</label> <br>
                    <label><input name="GrammarChoice" type="radio" value="LR1"> LR(1)</label> <br>
                    <label><input name="GrammarChoice" type="radio" value="SALR1"> SALR(1)</label> <br>
                </form>
            </div>
            <div class="col-sm-4">
                <h3>请输入文法规则</h3>
                <textarea name="GrammarInput" id="GrammarInput" cols="30" rows="10"></textarea>
            </div>
            <div class="col-sm-4">
                <h3>请输入要匹配的字符串</h3>
                <input type="text" id="stringInput">
                
            </div>
        </div>

        <div class="row" style="margin-top: 50px;">
            <div class="col-sm-3"></div>
            <div class="col-sm-6">
                <button class="btn btn-primary" style="width: 100%;" onclick="analysis()"><h4>开始分析</h4></button>
            </div>
            <div class="col-sm-3"></div>
        </div>

        <div id="processDiv" style="margin-top: 20px;"></div>
    </div>

    <div class="beforeFooter" id="beforeFooter"></div>
    <footer class="navbar-fixed-bottom" id="footer">
        <div class="container" style="background-color: #eeeeee">
            <div class="row">
                <div class="col-sm-6">项目地址: <a href="https://github.com/LetMeFly666/SyntaxAnalysis" target="blank">https://github.com/LetMeFly666/SyntaxAnalysis</a></div>
                <div class="col-sm-6">在线文档：<a href="https://yffx.letmefly.xyz" target="blank">https://yffx.letmefly.xyz (语法分析.letmefly.xyz)</a></div>
            </div>
            <div class="row" style="text-align: center;">
                <span>DFA可视化：<a href="https://github.com/mermaid-js/mermaid" target="blank">mermiad</a> </span>
                <span>使用 <a href="https://www.bootcss.com" target="blank">BootStrap</a>、<a href="https://jquery.com" target="blank">jQuery</a></span>
                <span>By <a href="https://letmefly.xyz" target="blank">LetMeFly</a></span>
            </div>
            <!-- <div class="row" style="text-align: center;">
                Copyright 2022 ©<a href="https://letmefly.xyz">LetMeFly</a> all rights reserved.
            </div> -->
        </div>
    </footer>

    <script>
        const grammarChoiceForm = $("#GrammarChoiceForm");
        const grammars = grammarChoiceForm.find("input");
        const grammarInput = $("#GrammarInput");
        const stringInput = $("#stringInput");
        const processDiv = $("#processDiv");

        function getChoosedGrammar() {  // 获取选择的语法
            for (var i = 0; i < grammars.length; i++) {
                if (grammars[i].checked) {
                    return grammars[i].value;
                }
            }
        }

        function choose1grammar() {  // 选择一个文法
            grammarInput[0].placeholder = grammarSamples[this.value].grammar + "\n----------------------------------------\n空格可作为分隔符，不可作为终结符\n“|”代表“或”\n“ε”代表“空”\n“->”作为推导符号\n“->”左边出现过的为非终结符，其余未提到的为终结符";
            stringInput[0].placeholder = grammarSamples[this.value].string;
        };

        function adjustFooter() {  // 调整底部距离
            const height = $("#footer").height();
            $("#beforeFooter").height(height);
        }

        function analysis() {  // 分析
            processDiv.empty();

            if (!grammarInput.val()) {
                grammarInput.val(grammarSamples[getChoosedGrammar()].grammar);
            }
            const NT = getNTG(grammarInput.val());
            // console.log(NT);

            if (NT.error.length) {
                const errorDiv = document.createElement("div");
                errorDiv.setAttribute("id", "errorDiv");
                processDiv.append(errorDiv);
                const h3 = document.createElement("h3");
                h3.innerText = "错误列表：";
                errorDiv.append(h3);
                const ul = document.createElement("ul");
                ul.setAttribute("id", "errorUl");
                ul.setAttribute("class", "list-group");
                errorDiv.append(ul);
                NT.error.forEach(e => {
                    const li = document.createElement("li");
                    li.setAttribute("class", "list-group-item");
                    li.innerText = e;
                    ul.append(li);
                });
                return;
            }

            const formattedGrammarsDiv = document.createElement("div");
            formattedGrammarsDiv.setAttribute("id", "formattedGrammarsDiv");
            processDiv.append(formattedGrammarsDiv);
            const h3 = document.createElement("h3");
            h3.innerText = "格式化文法规则：";
            formattedGrammarsDiv.append(h3);
            const ul = document.createElement("ul");
            ul.setAttribute("id", "formattedGrammarsUl");
            ul.setAttribute("class", "list-group");
            formattedGrammarsDiv.append(ul);
            NT.formattedGrammars.forEach(e => {
                const li = document.createElement("li");
                li.setAttribute("class", "list-group-item");
                li.innerText = e.N + " ->";
                e.T.forEach(thisT => {
                    li.innerText += " " + thisT;
                });
                ul.append(li);
            });

            const TDiv = document.createElement("div");
            formattedGrammarsDiv.setAttribute("id", "formattedGrammarsDiv");
            processDiv.append(TDiv);
            const h3_2 = document.createElement("h3");
            h3_2.innerText = "非终结符";
            formattedGrammarsDiv.append(h3_2);
            const ul_2 = document.createElement("ul");
            ul_2.setAttribute("id", "formattedGrammarsUl");
            ul_2.setAttribute("class", "list-group");
            formattedGrammarsDiv.append(ul_2);
            NT.N.forEach(e => {
                const li = document.createElement("li");
                li.setAttribute("class", "list-group-item");
                li.innerText = e;
                ul_2.append(li);
            });

            const NDiv = document.createElement("div");
            formattedGrammarsDiv.setAttribute("id", "formattedGrammarsDiv");
            processDiv.append(NDiv);
            const h3_3 = document.createElement("h3");
            h3_3.innerText = "终结符";
            formattedGrammarsDiv.append(h3_3);
            const ul_3 = document.createElement("ul");
            ul_3.setAttribute("id", "formattedGrammarsUl");
            ul_3.setAttribute("class", "list-group");
            formattedGrammarsDiv.append(ul_3);
            NT.T.forEach(e => {
                const li = document.createElement("li");
                li.setAttribute("class", "list-group-item");
                li.innerText = e;
                ul_3.append(li);
            });

            // 提取左因子
            const NTLefted = leftFactoring(NT);
        }

        $(() => {  // Onload
            grammars.click(choose1grammar);
            grammars[0].click();

            adjustFooter();
        });

        $(window).resize(() => adjustFooter());
    </script>

</body>

</html>